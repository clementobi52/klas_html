<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document Upload - KLAS</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>
  <!-- Custom Styles -->
  <style>
    /* Base styles */
    :root {
      --primary: #3b82f6;
      --primary-foreground: #ffffff;
      --muted: #f3f4f6;
      --muted-foreground: #6b7280;
      --border: #e5e7eb;
      --ring: #3b82f6;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      color: #0f172a;
      background-color: #f8fafc;
    }

    /* Card styles */
    .card {
      background-color: white;
      border-radius: 0.5rem;
      border: 1px solid var(--border);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    /* Button styles */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 0.375rem;
      font-weight: 500;
      font-size: 0.875rem;
      line-height: 1.25rem;
      padding: 0.5rem 1rem;
      transition: all 0.2s;
      cursor: pointer;
    }

    .btn-primary {
      background-color: var(--primary);
      color: var(--primary-foreground);
    }

    .btn-primary:hover {
      background-color: #2563eb;
    }

    .btn-outline {
      background-color: transparent;
      border: 1px solid var(--border);
    }

    .btn-outline:hover {
      background-color: var(--muted);
    }

    .btn-ghost {
      background-color: transparent;
    }

    .btn-ghost:hover {
      background-color: var(--muted);
    }

    .btn-destructive {
      background-color: #ef4444;
      color: white;
    }

    .btn-destructive:hover {
      background-color: #dc2626;
    }

    .btn-sm {
      padding: 0.25rem 0.5rem;
      font-size: 0.75rem;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Badge styles */
    .badge {
      display: inline-flex;
      align-items: center;
      border-radius: 9999px;
      font-size: 0.75rem;
      font-weight: 500;
      line-height: 1;
      padding: 0.25rem 0.5rem;
      white-space: nowrap;
    }

    .badge-outline {
      background-color: transparent;
      border: 1px solid var(--border);
    }

    .badge-secondary {
      background-color: #f3f4f6;
      color: #1f2937;
    }

    /* Input styles */
    .input {
      display: block;
      width: 100%;
      border-radius: 0.375rem;
      border: 1px solid var(--border);
      padding: 0.5rem 0.75rem;
      font-size: 0.875rem;
      line-height: 1.25rem;
      background-color: white;
    }

    .input:focus {
      outline: none;
      border-color: var(--ring);
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
    }

    /* Progress bar */
    .progress {
      position: relative;
      width: 100%;
      height: 0.5rem;
      overflow: hidden;
      background-color: var(--muted);
      border-radius: 9999px;
    }

    .progress-bar {
      position: absolute;
      height: 100%;
      background-color: var(--primary);
      transition: width 0.3s ease;
    }

    /* Dialog styles */
    .dialog-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }

    .dialog-content {
      background-color: white;
      border-radius: 0.5rem;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      width: 100%;
      max-width: 32rem;
      max-height: 90vh;
      overflow-y: auto;
    }

    .dialog-preview {
      max-width: 900px;
      height: 800px;
      display: flex;
      flex-direction: column;
    }

    /* Tab styles */
    .tabs {
      display: flex;
      flex-direction: column;
      width: 100%;
    }

    .tabs-list {
      display: flex;
      border-bottom: 1px solid var(--border);
    }

    .tab {
      padding: 0.5rem 1rem;
      font-size: 0.875rem;
      font-weight: 500;
      border-bottom: 2px solid transparent;
      cursor: pointer;
    }

    .tab[aria-selected="true"] {
      border-bottom-color: var(--primary);
      color: var(--primary);
    }

    .tab-content {
      display: none;
      padding-top: 1.5rem;
    }

    .tab-content[aria-hidden="false"] {
      display: block;
    }

    /* Radio group */
    .radio-group {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.5rem;
    }

    .radio-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .radio-item input[type="radio"] {
      width: 1rem;
      height: 1rem;
    }

    /* Custom animations */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .animate-fade-in {
      animation: fadeIn 0.3s ease-in-out;
    }

    /* Hide scrollbar for Chrome, Safari and Opera */
    .no-scrollbar::-webkit-scrollbar {
      display: none;
    }

    /* Hide scrollbar for IE, Edge and Firefox */
    .no-scrollbar {
      -ms-overflow-style: none;  /* IE and Edge */
      scrollbar-width: none;  /* Firefox */
    }
  </style>
</head>
<body class="bg-gray-50">
  <div class="container mx-auto py-6 space-y-6">
    <!-- Page Header -->
    <div class="flex flex-col space-y-2">
      <h1 class="text-2xl font-bold tracking-tight">Document Upload</h1>
      <p class="text-muted-foreground">Upload scanned documents to their digital folders</p>
    </div>

    <!-- Stats Cards -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
      <!-- Today's Uploads -->
      <div class="card">
        <div class="p-4 pb-2">
          <h3 class="text-sm font-medium">Today's Uploads</h3>
        </div>
        <div class="p-4 pt-0">
          <div class="text-2xl font-bold" id="uploads-count">1</div>
          <p class="text-xs text-muted-foreground mt-1">Batches uploaded today</p>
        </div>
      </div>

      <!-- Pending Page Typing -->
      <div class="card">
        <div class="p-4 pb-2">
          <h3 class="text-sm font-medium">Pending Page Typing</h3>
        </div>
        <div class="p-4 pt-0">
          <div class="text-2xl font-bold" id="pending-count">3</div>
          <p class="text-xs text-muted-foreground mt-1">Documents waiting for page typing</p>
        </div>
      </div>

      <!-- Next Steps -->
      <div class="card">
        <div class="p-4 pb-2">
          <h3 class="text-sm font-medium">Next Steps</h3>
        </div>
        <div class="p-4 pt-0">
          <div class="text-2xl font-bold flex items-center">
            Page Typing
            <span class="badge ml-2 bg-purple-500 text-white">Stage 3</span>
          </div>
          <p class="text-xs text-muted-foreground mt-1">After uploading, proceed to page typing</p>
        </div>
      </div>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <div class="tabs-list grid w-full md:w-auto grid-cols-2">
        <button class="tab" role="tab" aria-selected="true" data-tab="upload">Upload Documents</button>
        <button class="tab" role="tab" aria-selected="false" data-tab="uploaded-files">Uploaded Documents</button>
      </div>

      <!-- Upload Tab -->
      <div class="tab-content mt-6" role="tabpanel" aria-hidden="false" data-tab-content="upload">
        <div class="card">
          <div class="p-6 border-b">
            <div class="flex flex-col md:flex-row md:items-center justify-between">
              <div>
                <h2 class="text-lg font-semibold">Document Upload</h2>
                <p class="text-sm text-muted-foreground">Upload scanned documents to their digital folders</p>
              </div>
              <div class="mt-2 md:mt-0 selected-file-badge hidden">
                <span class="badge bg-blue-500 text-white px-3 py-1 flex items-center">
                  <i data-lucide="folder-open" class="h-4 w-4 mr-2"></i>
                  <span id="selected-file-number">No file selected</span>
                </span>
              </div>
            </div>
          </div>
          <div class="p-6">
            <div class="space-y-6">
              <div class="flex justify-between items-center">
                <label class="text-sm font-medium">Select Indexed File</label>
                <button class="btn btn-outline btn-sm gap-1" id="select-file-btn">
                  <i data-lucide="folder" class="h-4 w-4"></i>
                  <span id="change-file-text">Select File</span>
                </button>
              </div>

              <!-- Upload area -->
              <div class="border rounded-md p-4">
                <h3 class="text-sm font-medium mb-4">Upload Scanned Documents</h3>

                <!-- Idle state -->
                <div id="upload-idle" class="rounded-md border-2 border-dashed p-8 text-center">
                  <div class="mx-auto mb-4 flex h-12 w-12 items-center justify-center rounded-full bg-muted">
                    <i data-lucide="file-up" class="h-6 w-6"></i>
                  </div>
                  <h3 class="mb-2 text-lg font-medium">Drag and drop scanned documents here</h3>
                  <p class="mb-4 text-sm text-muted-foreground">or click to browse files on your computer</p>
                  <input type="file" multiple class="hidden" id="file-upload">
                  <button class="btn btn-primary gap-2" id="browse-files-btn" disabled>
                    <i data-lucide="upload" class="h-4 w-4"></i>
                    Browse Files
                  </button>
                  <p class="mt-2 text-sm text-red-500" id="select-file-warning">Please select an indexed file first</p>
                </div>

                <!-- Selected files list -->
                <div id="selected-files-container" class="rounded-md border divide-y mt-4 hidden">
                  <div class="p-3 bg-muted/50 flex justify-between items-center">
                    <span class="font-medium"><span id="selected-files-count">0</span> files selected</span>
                    <button class="btn btn-ghost btn-sm" id="clear-all-btn">Clear All</button>
                  </div>
                  <div id="selected-files-list">
                    <!-- Files will be added here dynamically -->
                  </div>
                </div>

                <!-- Uploading state -->
                <div id="upload-progress" class="space-y-2 mt-4 hidden">
                  <div class="flex justify-between text-sm">
                    <span>Uploading <span id="uploading-count">0</span> files...</span>
                    <span id="upload-percentage">0%</span>
                  </div>
                  <div class="progress">
                    <div class="progress-bar" id="progress-bar" style="width: 0%"></div>
                  </div>
                </div>

                <!-- Complete state -->
                <div id="upload-complete" class="mt-4 p-4 bg-green-50 border border-green-100 rounded-md hidden">
                  <div class="flex items-center gap-2 text-green-700">
                    <i data-lucide="check-circle" class="h-5 w-5"></i>
                    <span class="font-medium">Upload Complete!</span>
                  </div>
                  <p class="text-sm text-green-700 mt-1">
                    Files have been successfully uploaded and organized by paper size.
                  </p>
                </div>
              </div>

              <!-- Action buttons -->
              <div class="flex flex-col md:flex-row gap-4 justify-center">
                <!-- Start upload button (idle state) -->
                <button class="btn btn-primary gap-2 hidden" id="start-upload-btn">
                  <i data-lucide="upload" class="h-4 w-4"></i>
                  Start Upload
                </button>

                <!-- Cancel button (uploading state) -->
                <button class="btn btn-destructive gap-2 hidden" id="cancel-upload-btn">
                  <i data-lucide="alert-circle" class="h-4 w-4"></i>
                  Cancel
                </button>

                <!-- Complete state buttons -->
                <button class="btn btn-outline gap-2 hidden" id="upload-more-btn">
                  <i data-lucide="refresh-cw" class="h-4 w-4"></i>
                  Upload More
                </button>
                <button class="btn btn-primary gap-2 hidden" id="view-uploaded-btn">
                  <i data-lucide="check-circle" class="h-4 w-4"></i>
                  View Uploaded Files
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Uploaded Files Tab -->
      <div class="tab-content mt-6" role="tabpanel" aria-hidden="true" data-tab-content="uploaded-files">
        <div class="card">
          <div class="p-6 border-b">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
              <div>
                <h2 class="text-lg font-semibold">Uploaded Documents</h2>
                <p class="text-sm text-muted-foreground">Documents uploaded and ready for page typing</p>
              </div>
              <div class="flex flex-col md:flex-row items-end md:items-center gap-2">
                <div class="flex items-center gap-2">
                  <label for="paper-size-filter" class="text-sm font-medium whitespace-nowrap">Filter by Size:</label>
                  <select id="paper-size-filter" class="input w-[120px]">
                    <option value="All">All Sizes</option>
                    <option value="A4">A4</option>
                    <option value="A5">A5</option>
                    <option value="A3">A3</option>
                    <option value="Letter">Letter</option>
                    <option value="Legal">Legal</option>
                    <option value="Custom">Custom</option>
                  </select>
                </div>
                <div class="relative w-full md:w-64">
                  <i data-lucide="search" class="absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"></i>
                  <input type="search" placeholder="Search files..." class="input w-full pl-8">
                </div>
                <button class="btn btn-outline btn-sm whitespace-nowrap" id="toggle-view-btn">
                  Folder View
                </button>
              </div>
            </div>
          </div>
          <div class="p-6">
            <!-- Empty state -->
            <div id="no-documents" class="rounded-md border p-8 text-center hidden">
              <div class="mx-auto mb-4 flex h-12 w-12 items-center justify-center rounded-full bg-muted">
                <i data-lucide="file-text" class="h-6 w-6"></i>
              </div>
              <h3 class="mb-2 text-lg font-medium">No uploaded documents yet</h3>
              <p class="mb-4 text-sm text-muted-foreground">Upload documents to see them listed here</p>
              <button class="btn btn-primary gap-2" id="go-to-upload-btn">
                <i data-lucide="upload" class="h-4 w-4"></i>
                Go to Upload
              </button>
            </div>

            <!-- List view -->
            <div id="list-view" class="rounded-md border divide-y">
              <!-- Batches will be added here dynamically -->
            </div>

            <!-- Folder view -->
            <div id="folder-view" class="space-y-6 hidden">
              <!-- Folders will be added here dynamically -->
            </div>
          </div>
          <div id="batch-actions" class="flex justify-between border-t pt-4 p-6 hidden">
            <button class="btn btn-outline" id="upload-more-btn-2">Upload More</button>
            <button class="btn btn-primary gap-2" id="proceed-to-typing-btn">
              Proceed to Page Typing
              <i data-lucide="arrow-right" class="h-4 w-4"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Document Preview Dialog -->
    <div id="preview-dialog" class="dialog-backdrop hidden" aria-hidden="true">
      <div class="dialog-content dialog-preview animate-fade-in">
        <div class="p-4 border-b">
          <h2 class="text-lg font-semibold" id="preview-title">Document Preview</h2>
        </div>

        <div class="flex-1 overflow-auto border rounded-md relative p-4">
          <!-- Document viewer -->
          <div class="w-full h-full flex items-center justify-center bg-muted/30">
            <img
              id="preview-image"
              src="/placeholder.svg"
              alt="Document preview"
              class="max-h-full max-w-full object-contain transition-transform"
            >
          </div>
        </div>

        <!-- Document info -->
        <div class="mt-2 p-2 bg-muted/20 rounded-md flex items-center justify-between">
          <div id="document-info">
            <!-- Document info badges will be added here -->
          </div>
        </div>

        <!-- Controls -->
        <div class="flex justify-between mt-4 p-4">
          <div class="flex gap-2">
            <button class="btn btn-outline btn-sm" id="prev-page-btn">Previous</button>
            <button class="btn btn-outline btn-sm" id="next-page-btn">Next</button>
          </div>
          <div class="flex gap-2">
            <button class="btn btn-outline btn-sm" id="zoom-out-btn">
              <i data-lucide="zoom-out" class="h-4 w-4"></i>
            </button>
            <span class="px-2 py-1 border rounded-md text-sm" id="zoom-level">100%</span>
            <button class="btn btn-outline btn-sm" id="zoom-in-btn">
              <i data-lucide="zoom-in" class="h-4 w-4"></i>
            </button>
            <button class="btn btn-outline btn-sm" id="rotate-btn">
              <i data-lucide="rotate-cw" class="h-4 w-4"></i>
            </button>
          </div>
          <button class="btn btn-primary btn-sm" id="proceed-to-typing-from-preview-btn">
            Proceed to Page Typing
          </button>
        </div>
      </div>
    </div>

    <!-- File Selector Dialog -->
    <div id="file-selector-dialog" class="dialog-backdrop hidden" aria-hidden="true">
      <div class="dialog-content animate-fade-in">
        <div class="p-4 border-b">
          <h2 class="text-lg font-semibold">Select Indexed File for Document Upload</h2>
        </div>
        <div class="py-4 px-6">
          <div class="relative mb-4">
            <i data-lucide="search" class="absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"></i>
            <input type="search" placeholder="Search indexed files..." class="input w-full pl-8">
          </div>
          <div class="rounded-md border divide-y max-h-[400px] overflow-y-auto" id="indexed-files-list">
            <!-- Indexed files will be added here dynamically -->
          </div>
        </div>
        <div class="flex justify-end gap-2 p-4 border-t">
          <button class="btn btn-outline" id="cancel-file-select-btn">Cancel</button>
          <button class="btn btn-primary" id="confirm-file-select-btn" disabled>Select File</button>
        </div>
      </div>
    </div>

    <!-- Document Details Dialog -->
    <div id="document-details-dialog" class="dialog-backdrop hidden" aria-hidden="true">
      <div class="dialog-content animate-fade-in">
        <div class="p-4 border-b">
          <h2 class="text-lg font-semibold">Document Details</h2>
        </div>
        <div class="py-4 px-6 space-y-4">
          <div>
            <label for="document-name" class="block mb-2 text-sm font-medium">File Name</label>
            <p class="text-sm font-medium" id="document-name"></p>
          </div>

          <div>
            <label for="paper-size" class="block mb-2 text-sm font-medium">Paper Size</label>
            <div class="radio-group">
              <div class="radio-item">
                <input type="radio" name="paper-size" id="A4" value="A4">
                <label for="A4" class="text-sm">A4</label>
              </div>
              <div class="radio-item">
                <input type="radio" name="paper-size" id="A5" value="A5">
                <label for="A5" class="text-sm">A5</label>
              </div>
              <div class="radio-item">
                <input type="radio" name="paper-size" id="A3" value="A3">
                <label for="A3" class="text-sm">A3</label>
              </div>
              <div class="radio-item">
                <input type="radio" name="paper-size" id="Letter" value="Letter">
                <label for="Letter" class="text-sm">Letter</label>
              </div>
              <div class="radio-item">
                <input type="radio" name="paper-size" id="Legal" value="Legal">
                <label for="Legal" class="text-sm">Legal</label>
              </div>
              <div class="radio-item">
                <input type="radio" name="paper-size" id="Custom" value="Custom">
                <label for="Custom" class="text-sm">Custom</label>
              </div>
            </div>
          </div>

          <div>
            <label for="document-type" class="block mb-2 text-sm font-medium">Document Type</label>
            <select id="document-type" class="input">
              <option value="Certificate">Certificate</option>
              <option value="Deed">Deed</option>
              <option value="Letter">Letter</option>
              <option value="Application Form">Application Form</option>
              <option value="Map">Map</option>
              <option value="Survey Plan">Survey Plan</option>
              <option value="Receipt">Receipt</option>
              <option value="Other">Other</option>
            </select>
          </div>

          <div>
            <label for="document-notes" class="block mb-2 text-sm font-medium">Notes (Optional)</label>
            <textarea id="document-notes" class="input" rows="3"></textarea>
          </div>
        </div>
        <div class="flex justify-end gap-2 p-4 border-t">
          <button class="btn btn-outline" id="cancel-details-btn">Cancel</button>
          <button class="btn btn-primary" id="save-details-btn">Save Details</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Initialize Lucide icons
    lucide.createIcons();

    // State management
    const state = {
      activeTab: 'upload',
      uploadStatus: 'idle', // 'idle', 'uploading', 'complete', 'error'
      uploadProgress: 0,
      previewOpen: false,
      selectedFile: null,
      zoomLevel: 100,
      rotation: 0,
      currentPreviewPage: 1,
      selectedIndexedFile: null,
      showFileSelector: false,
      selectedUploadFiles: [],
      showFolderView: false,
      selectedPageInFolder: null,
      showDocumentDetails: false,
      currentDocumentIndex: null,
      documentBatches: [],
      uploadDocuments: [],
      filterPaperSize: 'All'
    };

    // Sample data
    const documentTypes = ["Certificate", "Deed", "Letter", "Application Form", "Map", "Survey Plan", "Receipt", "Other"];

    const indexedFiles = [
      {
        id: "FILE-2023-004",
        fileNumber: "KNML 08146",
        name: "Musa Usman Bayero",
        type: "Right of Occupancy",
        landUseType: "Residential",
        district: "Nasarawa",
      },
      {
        id: "FILE-2023-005",
        fileNumber: "MLKN 03888",
        name: "Hajiya Fatima Mohammed",
        type: "Deed of Assignment",
        landUseType: "Industrial",
        district: "Bompai",
      },
      {
        id: "FILE-2023-006",
        fileNumber: "KNGP 00721",
        name: "Abdullahi Sani",
        type: "Site Plan",
        landUseType: "Commercial",
        district: "Fagge",
      },
    ];

    // Sample document previews
    const samplePages = [
      "https://via.placeholder.com/800x1000/f8fafc/1e293b?text=Document+Page+1",
      "https://via.placeholder.com/800x1000/f8fafc/1e293b?text=Document+Page+2",
      "https://via.placeholder.com/800x1000/f8fafc/1e293b?text=Document+Page+3"
    ];

    // Initialize with a sample batch
    state.documentBatches = [
      {
        id: "BATCH-EXAMPLE",
        fileNumber: "KNML 09846",
        name: "Alhaji Ibrahim Dantata",
        documents: [
          {
            fileName: "certificate.pdf",
            fileSize: 1024 * 1024, // 1MB
            paperSize: "A4",
            documentType: "Certificate",
          },
          {
            fileName: "deed.pdf",
            fileSize: 512 * 1024, // 0.5MB
            paperSize: "A5",
            documentType: "Deed",
          },
          {
            fileName: "letter.pdf",
            fileSize: 256 * 1024, // 0.25MB
            paperSize: "A4",
            documentType: "Letter",
          },
        ],
        date: "2023-06-18",
        status: "Ready for page typing",
      },
    ];

    // DOM Elements
    const elements = {
      // Tabs
      tabs: document.querySelectorAll('[role="tab"]'),
      tabContents: document.querySelectorAll('[role="tabpanel"]'),
      
      // Upload tab
      selectedFileBadge: document.querySelector('.selected-file-badge'),
      selectedFileNumber: document.getElementById('selected-file-number'),
      selectFileBtn: document.getElementById('select-file-btn'),
      changeFileText: document.getElementById('change-file-text'),
      uploadIdle: document.getElementById('upload-idle'),
      fileUpload: document.getElementById('file-upload'),
      browseFilesBtn: document.getElementById('browse-files-btn'),
      selectFileWarning: document.getElementById('select-file-warning'),
      selectedFilesContainer: document.getElementById('selected-files-container'),
      selectedFilesCount: document.getElementById('selected-files-count'),
      selectedFilesList: document.getElementById('selected-files-list'),
      clearAllBtn: document.getElementById('clear-all-btn'),
      uploadProgress: document.getElementById('upload-progress'),
      uploadingCount: document.getElementById('uploading-count'),
      uploadPercentage: document.getElementById('upload-percentage'),
      progressBar: document.getElementById('progress-bar'),
      uploadComplete: document.getElementById('upload-complete'),
      startUploadBtn: document.getElementById('start-upload-btn'),
      cancelUploadBtn: document.getElementById('cancel-upload-btn'),
      uploadMoreBtn: document.getElementById('upload-more-btn'),
      viewUploadedBtn: document.getElementById('view-uploaded-btn'),
      
      // Uploaded files tab
      uploadsCount: document.getElementById('uploads-count'),
      pendingCount: document.getElementById('pending-count'),
      paperSizeFilter: document.getElementById('paper-size-filter'),
      toggleViewBtn: document.getElementById('toggle-view-btn'),
      noDocuments: document.getElementById('no-documents'),
      listView: document.getElementById('list-view'),
      folderView: document.getElementById('folder-view'),
      batchActions: document.getElementById('batch-actions'),
      uploadMoreBtn2: document.getElementById('upload-more-btn-2'),
      proceedToTypingBtn: document.getElementById('proceed-to-typing-btn'),
      goToUploadBtn: document.getElementById('go-to-upload-btn'),
      
      // Preview dialog
      previewDialog: document.getElementById('preview-dialog'),
      previewTitle: document.getElementById('preview-title'),
      previewImage: document.getElementById('preview-image'),
      documentInfo: document.getElementById('document-info'),
      prevPageBtn: document.getElementById('prev-page-btn'),
      nextPageBtn: document.getElementById('next-page-btn'),
      zoomOutBtn: document.getElementById('zoom-out-btn'),
      zoomLevel: document.getElementById('zoom-level'),
      zoomInBtn: document.getElementById('zoom-in-btn'),
      rotateBtn: document.getElementById('rotate-btn'),
      proceedToTypingFromPreviewBtn: document.getElementById('proceed-to-typing-from-preview-btn'),
      
      // File selector dialog
      fileSelectorDialog: document.getElementById('file-selector-dialog'),
      indexedFilesList: document.getElementById('indexed-files-list'),
      cancelFileSelectBtn: document.getElementById('cancel-file-select-btn'),
      confirmFileSelectBtn: document.getElementById('confirm-file-select-btn'),
      
      // Document details dialog
      documentDetailsDialog: document.getElementById('document-details-dialog'),
      documentName: document.getElementById('document-name'),
      paperSizeRadios: document.querySelectorAll('input[name="paper-size"]'),
      documentType: document.getElementById('document-type'),
      documentNotes: document.getElementById('document-notes'),
      cancelDetailsBtn: document.getElementById('cancel-details-btn'),
      saveDetailsBtn: document.getElementById('save-details-btn')
    };

    // Helper functions
    function formatFileSize(bytes) {
      if (bytes < 1024) return bytes + " B";
      else if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + " KB";
      else return (bytes / (1024 * 1024)).toFixed(2) + " MB";
    }

    function getPaperSizeColor(size) {
      switch (size) {
        case "A4": return "bg-blue-500";
        case "A5": return "bg-green-500";
        case "A3": return "bg-purple-500";
        case "Letter": return "bg-amber-500";
        case "Legal": return "bg-rose-500";
        case "Custom": return "bg-gray-500";
        default: return "bg-gray-500";
      }
    }

    // UI update functions
    function updateUI() {
      // Update tabs
      elements.tabs.forEach(tab => {
        const tabId = tab.getAttribute('data-tab');
        tab.setAttribute('aria-selected', tabId === state.activeTab);
      });
      
      elements.tabContents.forEach(content => {
        const contentId = content.getAttribute('data-tab-content');
        content.setAttribute('aria-hidden', contentId !== state.activeTab);
      });

      // Update selected file badge
      if (state.selectedIndexedFile) {
        const selectedFile = indexedFiles.find(f => f.id === state.selectedIndexedFile);
        elements.selectedFileBadge.classList.remove('hidden');
        elements.selectedFileNumber.textContent = selectedFile ? selectedFile.fileNumber : 'No file selected';
        elements.changeFileText.textContent = 'Change File';
        elements.browseFilesBtn.disabled = false;
        elements.selectFileWarning.classList.add('hidden');
      } else {
        elements.selectedFileBadge.classList.add('hidden');
        elements.changeFileText.textContent = 'Select File';
        elements.browseFilesBtn.disabled = true;
        elements.selectFileWarning.classList.remove('hidden');
      }

      // Update upload status
      elements.uploadIdle.classList.toggle('hidden', state.uploadStatus !== 'idle');
      elements.uploadProgress.classList.toggle('hidden', state.uploadStatus !== 'uploading');
      elements.uploadComplete.classList.toggle('hidden', state.uploadStatus !== 'complete');
      
      // Update buttons based on upload status
      elements.startUploadBtn.classList.toggle('hidden', 
        !(state.uploadStatus === 'idle' && state.uploadDocuments.length > 0));
      elements.cancelUploadBtn.classList.toggle('hidden', state.uploadStatus !== 'uploading');
      elements.uploadMoreBtn.classList.toggle('hidden', state.uploadStatus !== 'complete');
      elements.viewUploadedBtn.classList.toggle('hidden', state.uploadStatus !== 'complete');

      // Update selected files
      elements.selectedFilesContainer.classList.toggle('hidden', state.uploadDocuments.length === 0);
      elements.selectedFilesCount.textContent = state.uploadDocuments.length;
      
      if (state.uploadDocuments.length > 0) {
        renderSelectedFiles();
      }

      // Update upload progress
      if (state.uploadStatus === 'uploading') {
        elements.uploadingCount.textContent = state.uploadDocuments.length;
        elements.uploadPercentage.textContent = `${state.uploadProgress}%`;
        elements.progressBar.style.width = `${state.uploadProgress}%`;
      }

      // Update uploaded files tab
      elements.uploadsCount.textContent = state.documentBatches.length;
      elements.pendingCount.textContent = state.documentBatches.reduce(
        (total, batch) => total + batch.documents.length, 0
      );

      elements.noDocuments.classList.toggle('hidden', state.documentBatches.length > 0);
      elements.batchActions.classList.toggle('hidden', state.documentBatches.length === 0);
      
      // Update view toggle
      elements.toggleViewBtn.textContent = state.showFolderView ? 'List View' : 'Folder View';
      elements.listView.classList.toggle('hidden', state.showFolderView);
      elements.folderView.classList.toggle('hidden', !state.showFolderView);

      if (state.documentBatches.length > 0) {
        renderBatches();
      }

      // Update dialogs
      elements.previewDialog.classList.toggle('hidden', !state.previewOpen);
      elements.fileSelectorDialog.classList.toggle('hidden', !state.showFileSelector);
      elements.documentDetailsDialog.classList.toggle('hidden', !state.showDocumentDetails);

      // Update preview
      if (state.previewOpen && state.selectedFile) {
        updatePreview();
      }

      // Update file selector
      if (state.showFileSelector) {
        renderIndexedFiles();
      }

      // Update document details
      if (state.showDocumentDetails && state.currentDocumentIndex !== null) {
        updateDocumentDetails();
      }
    }

    function renderSelectedFiles() {
      elements.selectedFilesList.innerHTML = '';
      
      state.uploadDocuments.forEach((doc, index) => {
        const fileItem = document.createElement('div');
        fileItem.className = 'flex items-center justify-between p-3';
        fileItem.innerHTML = `
          <div class="flex items-center gap-3">
            <i data-lucide="file" class="h-8 w-8 text-blue-500"></i>
            <div>
              <p class="font-medium">${doc.file.name}</p>
              <div class="flex items-center gap-2 mt-1">
                <span class="badge ${getPaperSizeColor(doc.paperSize)} text-white text-xs">${doc.paperSize}</span>
                <span class="badge badge-outline text-xs">${doc.documentType}</span>
                <span class="text-xs text-muted-foreground">${formatFileSize(doc.file.size)}</span>
              </div>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <button class="btn btn-outline btn-sm edit-details" data-index="${index}">
              Edit Details
            </button>
            <button class="btn btn-ghost btn-sm remove-file" data-index="${index}">
              <i data-lucide="trash-2" class="h-4 w-4"></i>
            </button>
          </div>
        `;
        
        elements.selectedFilesList.appendChild(fileItem);
      });
      
      // Initialize icons for the new elements
      lucide.createIcons();
      
      // Add event listeners
      document.querySelectorAll('.edit-details').forEach(btn => {
        btn.addEventListener('click', () => {
          const index = parseInt(btn.getAttribute('data-index'));
          openDocumentDetails(index);
        });
      });
      
      document.querySelectorAll('.remove-file').forEach(btn => {
        btn.addEventListener('click', () => {
          const index = parseInt(btn.getAttribute('data-index'));
          removeFile(index);
        });
      });
    }

    function renderBatches() {
      const filteredBatches = getFilteredBatches();
      
      if (state.showFolderView) {
        renderFolderView(filteredBatches);
      } else {
        renderListView(filteredBatches);
      }
    }

    function renderListView(batches) {
      elements.listView.innerHTML = '';
      
      batches.forEach(batch => {
        const batchItem = document.createElement('div');
        batchItem.className = 'flex items-center justify-between p-4';
        
        // Get unique paper sizes
        const uniquePaperSizes = Array.from(new Set(batch.documents.map(d => d.paperSize)));
        
        batchItem.innerHTML = `
          <div class="flex items-center gap-3">
            <i data-lucide="file-text" class="h-8 w-8 text-blue-500"></i>
            <div>
              <p class="font-medium text-blue-600">${batch.fileNumber}</p>
              <p class="text-sm text-gray-600">${batch.name}</p>
              <div class="flex items-center gap-2 mt-1">
                <span class="badge badge-outline text-xs">
                  ${batch.documents.length} ${batch.documents.length === 1 ? 'document' : 'documents'}
                </span>
                <span class="text-xs text-muted-foreground">${batch.date}</span>
                <div class="flex gap-1">
                  ${uniquePaperSizes.map(size => 
                    `<span class="badge ${getPaperSizeColor(size)} text-white text-xs">${size}</span>`
                  ).join('')}
                </div>
              </div>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <button class="btn btn-outline btn-sm preview-batch" data-id="${batch.id}">
              <i data-lucide="zoom-in" class="h-4 w-4 mr-1"></i>
              Preview
            </button>
            <button class="btn btn-outline btn-sm start-typing" data-id="${batch.id}">
              Start Page Typing
            </button>
            <button class="btn btn-ghost btn-sm text-red-500 delete-batch" data-id="${batch.id}">
              <i data-lucide="trash-2" class="h-4 w-4"></i>
            </button>
          </div>
        `;
        
        elements.listView.appendChild(batchItem);
      });
      
      // Initialize icons for the new elements
      lucide.createIcons();
      
      // Add event listeners
      document.querySelectorAll('.preview-batch').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.getAttribute('data-id');
          openPreview(id);
        });
      });
      
      document.querySelectorAll('.start-typing').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.getAttribute('data-id');
          window.location.href = `/file-digital-registry/page-typing?fileId=${id}`;
        });
      });
      
      document.querySelectorAll('.delete-batch').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.getAttribute('data-id');
          deleteBatch(id);
        });
      });
    }

    function renderFolderView(batches) {
      elements.folderView.innerHTML = '';
      
      batches.forEach(batch => {
        const folderItem = document.createElement('div');
        folderItem.className = 'border rounded-md overflow-hidden';
        
        folderItem.innerHTML = `
          <div class="p-4 bg-muted/20 border-b">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <i data-lucide="folder-open" class="h-6 w-6 text-blue-500"></i>
                <div>
                  <p class="font-medium text-blue-600">${batch.fileNumber}</p>
                  <p class="text-sm">${batch.name}</p>
                </div>
              </div>
              <div class="flex items-center gap-2">
                <span class="badge badge-outline text-xs">
                  ${batch.documents.length} ${batch.documents.length === 1 ? 'document' : 'documents'}
                </span>
                <button class="btn btn-outline btn-sm start-typing" data-id="${batch.id}">
                  Start Page Typing
                </button>
              </div>
            </div>
          </div>
          <div class="p-4">
            <h4 class="text-sm font-medium mb-3">Documents</h4>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 documents-grid" data-batch-id="${batch.id}">
              <!-- Documents will be added here -->
            </div>
          </div>
        `;
        
        elements.folderView.appendChild(folderItem);
        
        // Add documents to the grid
        const documentsGrid = folderItem.querySelector('.documents-grid');
        
        batch.documents
          .filter(doc => state.filterPaperSize === 'All' || doc.paperSize === state.filterPaperSize)
          .forEach((doc, index) => {
            const docItem = document.createElement('div');
            docItem.className = 'border rounded-md overflow-hidden cursor-pointer hover:border-blue-500 transition-colors document-item';
            docItem.setAttribute('data-batch-id', batch.id);
            docItem.setAttribute('data-index', index);
            
            // Use sample pages for preview
            const pageImage = samplePages[index % samplePages.length];
            
            docItem.innerHTML = `
              <div class="h-40 bg-muted flex items-center justify-center">
                <img
                  src="${pageImage}"
                  alt="Document ${index + 1}"
                  class="max-h-full max-w-full object-contain"
                >
              </div>
              <div class="p-2 bg-gray-50 border-t">
                <div class="flex justify-between items-center">
                  <span class="text-sm font-medium">Document ${index + 1}</span>
                  <span class="badge ${getPaperSizeColor(doc.paperSize)} text-white text-xs">${doc.paperSize}</span>
                </div>
                <div class="mt-1">
                  <span class="badge badge-outline text-xs w-full justify-center">${doc.documentType}</span>
                </div>
                <div class="mt-1">
                  <span class="badge bg-blue-500 text-white text-xs mt-1 w-full justify-center overflow-hidden text-ellipsis">
                    ${batch.fileNumber}-${(index + 1).toString().padStart(2, '0')}
                  </span>
                </div>
              </div>
            `;
            
            documentsGrid.appendChild(docItem);
          });
      });
      
      // Initialize icons for the new elements
      lucide.createIcons();
      
      // Add event listeners
      document.querySelectorAll('.start-typing').forEach(btn => {
        btn.addEventListener('click', () => {
          const id = btn.getAttribute('data-id');
          window.location.href = `/file-digital-registry/page-typing?fileId=${id}`;
        });
      });
      
      document.querySelectorAll('.document-item').forEach(item => {
        item.addEventListener('click', () => {
          const batchId = item.getAttribute('data-batch-id');
          const index = parseInt(item.getAttribute('data-index'));
          openPreview(batchId, index);
        });
      });
    }

    function updatePreview() {
      const batch = state.documentBatches.find(b => b.id === state.selectedFile);
      
      if (!batch) return;
      
      // Update title
      elements.previewTitle.textContent = `${batch.name} - Document ${state.currentPreviewPage} of ${batch.documents.length}`;
      
      // Update image
      const pageImage = samplePages[(state.currentPreviewPage - 1) % samplePages.length];
      elements.previewImage.src = pageImage;
      elements.previewImage.style.transform = `scale(${state.zoomLevel / 100}) rotate(${state.rotation}deg)`;
      
      // Update document info
      elements.documentInfo.innerHTML = '';
      
      const fileNumberBadge = document.createElement('span');
      fileNumberBadge.className = 'badge mr-2';
      fileNumberBadge.textContent = `${batch.fileNumber}-${state.currentPreviewPage.toString().padStart(2, '0')}`;
      elements.documentInfo.appendChild(fileNumberBadge);
      
      if (batch.documents[state.currentPreviewPage - 1]) {
        const doc = batch.documents[state.currentPreviewPage - 1];
        
        const paperSizeBadge = document.createElement('span');
        paperSizeBadge.className = `badge mr-2 ${getPaperSizeColor(doc.paperSize)}`;
        paperSizeBadge.textContent = doc.paperSize;
        elements.documentInfo.appendChild(paperSizeBadge);
        
        const typeBadge = document.createElement('span');
        typeBadge.className = 'badge badge-outline';
        typeBadge.textContent = doc.documentType;
        elements.documentInfo.appendChild(typeBadge);
      }
      
      // Update navigation buttons
      elements.prevPageBtn.disabled = state.currentPreviewPage <= 1;
      elements.nextPageBtn.disabled = state.currentPreviewPage >= batch.documents.length;
      
      // Update zoom level
      elements.zoomLevel.textContent = `${state.zoomLevel}%`;
    }

    function renderIndexedFiles() {
      elements.indexedFilesList.innerHTML = '';
      
      indexedFiles.forEach(file => {
        const fileItem = document.createElement('div');
        fileItem.className = `flex items-center p-4 cursor-pointer hover:bg-muted/50 ${
          state.selectedIndexedFile === file.id ? 'bg-muted' : ''
        }`;
        fileItem.setAttribute('data-id', file.id);
        
        fileItem.innerHTML = `
          <i data-lucide="folder" class="h-6 w-6 mr-3 ${
            state.selectedIndexedFile === file.id ? 'text-blue-500' : 'text-gray-400'
          }"></i>
          <div>
            <p class="font-medium text-blue-600">${file.fileNumber}</p>
            <p class="text-sm">${file.name}</p>
            <div class="flex items-center gap-2 mt-1">
              <span class="badge badge-secondary text-xs">${file.landUseType}</span>
              <span class="badge badge-outline text-xs">${file.district}</span>
            </div>
          </div>
        `;
        
        elements.indexedFilesList.appendChild(fileItem);
      });
      
      // Initialize icons for the new elements
      lucide.createIcons();
      
      // Add event listeners
      document.querySelectorAll('#indexed-files-list > div').forEach(item => {
        item.addEventListener('click', () => {
          const id = item.getAttribute('data-id');
          selectIndexedFileTemp(id);
        });
      });
      
      // Update confirm button
      elements.confirmFileSelectBtn.disabled = !state.selectedIndexedFile;
    }

    function updateDocumentDetails() {
      const doc = state.uploadDocuments[state.currentDocumentIndex];
      
      if (!doc) return;
      
      // Update file name
      elements.documentName.textContent = doc.file.name;
      
      // Update paper size
      elements.paperSizeRadios.forEach(radio => {
        radio.checked = radio.value === doc.paperSize;
      });
      
      // Update document type
      elements.documentType.value = doc.documentType;
      
      // Update notes
      elements.documentNotes.value = doc.notes || '';
    }

    function getFilteredBatches() {
      if (state.filterPaperSize === 'All') {
        return state.documentBatches;
      }
      
      return state.documentBatches.filter(batch => 
        batch.documents.some(doc => doc.paperSize === state.filterPaperSize)
      );
    }

    // Event handlers
    function switchTab(tabId) {
      state.activeTab = tabId;
      updateUI();
    }

    function handleFileSelect(e) {
      if (e.target.files && e.target.files.length > 0) {
        const files = Array.from(e.target.files);
        state.selectedUploadFiles = files;
        
        // Initialize upload documents with default values
        state.uploadDocuments = files.map(file => ({
          file,
          paperSize: 'A4', // Default paper size
          documentType: 'Other', // Default document type
        }));
        
        updateUI();
      }
    }

    function openDocumentDetails(index) {
      state.currentDocumentIndex = index;
      state.showDocumentDetails = true;
      updateUI();
    }

    function updateDocumentDetails(index, updates) {
      state.uploadDocuments = state.uploadDocuments.map((doc, i) => 
        i === index ? { ...doc, ...updates } : doc
      );
      updateUI();
    }

    function startUpload() {
      if (!state.selectedIndexedFile) {
        state.showFileSelector = true;
        updateUI();
        return;
      }
      
      if (state.uploadDocuments.length === 0) {
        alert('Please select files to upload');
        return;
      }
      
      state.uploadStatus = 'uploading';
      state.uploadProgress = 0;
      updateUI();
      
      const interval = setInterval(() => {
        state.uploadProgress += 10;
        
        if (state.uploadProgress >= 100) {
          clearInterval(interval);
          state.uploadProgress = 100;
          state.uploadStatus = 'complete';
          
          // Find the selected indexed file
          const indexedFile = indexedFiles.find(f => f.id === state.selectedIndexedFile);
          
          // Add a new batch to the list
          if (indexedFile) {
            // Convert UploadDocument to BatchDocument
            const batchDocuments = state.uploadDocuments.map(doc => ({
              fileName: doc.file.name,
              fileSize: doc.file.size,
              paperSize: doc.paperSize,
              documentType: doc.documentType,
              notes: doc.notes,
            }));
            
            const newBatch = {
              id: `BATCH-${Date.now()}`,
              fileNumber: indexedFile.fileNumber,
              name: indexedFile.name,
              documents: batchDocuments,
              date: new Date().toLocaleDateString(),
              status: 'Ready for page typing',
            };
            
            state.documentBatches = [newBatch, ...state.documentBatches];
          }
        }
        
        updateUI();
      }, 500);
    }

    function resetUpload() {
      state.uploadStatus = 'idle';
      state.uploadProgress = 0;
      state.selectedUploadFiles = [];
      state.uploadDocuments = [];
      elements.fileUpload.value = '';
      updateUI();
    }

    function sendToPageTyping() {
      if (state.documentBatches.length === 0) {
        alert('No files to send to page typing');
        return;
      }
      
      window.location.href = '/file-digital-registry/page-typing';
    }

    function openPreview(batchId, documentIndex = 0) {
      state.selectedFile = batchId;
      state.currentPreviewPage = documentIndex + 1;
      state.zoomLevel = 100;
      state.rotation = 0;
      state.previewOpen = true;
      updateUI();
    }

    function closePreview() {
      state.previewOpen = false;
      updateUI();
    }

    function nextPage() {
      const batch = state.documentBatches.find(b => b.id === state.selectedFile);
      if (batch && state.currentPreviewPage < batch.documents.length) {
        state.currentPreviewPage++;
        updateUI();
      }
    }

    function prevPage() {
      if (state.currentPreviewPage > 1) {
        state.currentPreviewPage--;
        updateUI();
      }
    }

    function zoomIn() {
      state.zoomLevel = Math.min(state.zoomLevel + 25, 200);
      updateUI();
    }

    function zoomOut() {
      state.zoomLevel = Math.max(state.zoomLevel - 25, 50);
      updateUI();
    }

    function rotate() {
      state.rotation = (state.rotation + 90) % 360;
      updateUI();
    }

    function selectIndexedFileTemp(fileId) {
      // This is just for UI updates in the dialog
      document.querySelectorAll('#indexed-files-list > div').forEach(item => {
        const id = item.getAttribute('data-id');
        const folderIcon = item.querySelector('[data-lucide="folder"]');
        
        if (id === fileId) {
          item.classList.add('bg-muted');
          folderIcon.classList.add('text-blue-500');
          folderIcon.classList.remove('text-gray-400');
        } else {
          item.classList.remove('bg-muted');
          folderIcon.classList.remove('text-blue-500');
          folderIcon.classList.add('text-gray-400');
        }
      });
      
      // Update confirm button
      elements.confirmFileSelectBtn.disabled = !fileId;
      
      // Store the selected ID temporarily
      state.selectedIndexedFile = fileId;
    }

    function selectIndexedFile() {
      state.showFileSelector = false;
      updateUI();
    }

    function removeFile(index) {
      state.selectedUploadFiles = state.selectedUploadFiles.filter((_, i) => i !== index);
      state.uploadDocuments = state.uploadDocuments.filter((_, i) => i !== index);
      updateUI();
    }

    function deleteBatch(id) {
      if (confirm('Are you sure you want to delete this batch?')) {
        state.documentBatches = state.documentBatches.filter(batch => batch.id !== id);
        updateUI();
      }
    }

    function saveDocumentDetails() {
      if (state.currentDocumentIndex === null) return;
      
      const paperSize = Array.from(elements.paperSizeRadios).find(radio => radio.checked)?.value || 'A4';
      const documentType = elements.documentType.value;
      const notes = elements.documentNotes.value;
      
      updateDocumentDetails(state.currentDocumentIndex, {
        paperSize: paperSize,
        documentType: documentType,
        notes: notes
      });
      
      state.showDocumentDetails = false;
      updateUI();
    }

    // Initialize the page
    function init() {
      // Set up event listeners
      
      // Tab switching
      elements.tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          const tabId = tab.getAttribute('data-tab');
          switchTab(tabId);
        });
      });
      
      // File upload
      elements.fileUpload.addEventListener('change', handleFileSelect);
      elements.browseFilesBtn.addEventListener('click', () => elements.fileUpload.click());
      
      // Select file
      elements.selectFileBtn.addEventListener('click', () => {
        state.showFileSelector = true;
        updateUI();
      });
      
      // Upload actions
      elements.clearAllBtn.addEventListener('click', resetUpload);
      elements.startUploadBtn.addEventListener('click', startUpload);
      elements.cancelUploadBtn.addEventListener('click', resetUpload);
      elements.uploadMoreBtn.addEventListener('click', resetUpload);
      elements.viewUploadedBtn.addEventListener('click', () => switchTab('uploaded-files'));
      elements.uploadMoreBtn2.addEventListener('click', () => switchTab('upload'));
      elements.proceedToTypingBtn.addEventListener('click', sendToPageTyping);
      elements.goToUploadBtn.addEventListener('click', () => switchTab('upload'));
      
      // Preview dialog
      elements.previewDialog.addEventListener('click', e => {
        if (e.target === elements.previewDialog) {
          closePreview();
        }
      });
      elements.prevPageBtn.addEventListener('click', prevPage);
      elements.nextPageBtn.addEventListener('click', nextPage);
      elements.zoomInBtn.addEventListener('click', zoomIn);
      elements.zoomOutBtn.addEventListener('click', zoomOut);
      elements.rotateBtn.addEventListener('click', rotate);
      elements.proceedToTypingFromPreviewBtn.addEventListener('click', () => {
        if (state.selectedFile) {
          window.location.href = `/file-digital-registry/page-typing?fileId=${state.selectedFile}`;
        }
      });
      
      // File selector dialog
      elements.fileSelectorDialog.addEventListener('click', e => {
        if (e.target === elements.fileSelectorDialog) {
          state.showFileSelector = false;
          updateUI();
        }  {
          state.showFileSelector = false;
          updateUI();
        }
      });
      elements.cancelFileSelectBtn.addEventListener('click', () => {
        state.showFileSelector = false;
        updateUI();
      });
      elements.confirmFileSelectBtn.addEventListener('click', selectIndexedFile);
      
      // Document details dialog
      elements.documentDetailsDialog.addEventListener('click', e => {
        if (e.target === elements.documentDetailsDialog) {
          state.showDocumentDetails = false;
          updateUI();
        }
      });
      elements.cancelDetailsBtn.addEventListener('click', () => {
        state.showDocumentDetails = false;
        updateUI();
      });
      elements.saveDetailsBtn.addEventListener('click', saveDocumentDetails);
      
      // Toggle view
      elements.toggleViewBtn.addEventListener('click', () => {
        state.showFolderView = !state.showFolderView;
        updateUI();
      });
      
      // Paper size filter
      elements.paperSizeFilter.addEventListener('change', () => {
        state.filterPaperSize = elements.paperSizeFilter.value;
        updateUI();
      });
      
      // Initial UI update
      updateUI();
      
      // Render indexed files
      renderIndexedFiles();
      
      // Render batches
      renderBatches();
    }
    
    // Initialize the page when DOM is loaded
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>